# rust-tty-movie

Сделать крутящуюся штуку, которая знак радиации. Из звёздочек. Медленно крутящуюся. А за ней медленно плывут полосочки, в разные стороны. Тонкие, дымок. А на фоне постоянно, словно шум на кассете, пробегают иногда точки, или просто разные символы. Двоеточие, апострофы и так далее.

### Мысли, как делать-то?

Как и в случае с эликсиром, очень удобной может вдруг оказаться идея компонентов?

```vue
<template>
  <!-- Обычная точка, рисуется как есть -->
  <dot x="412" y="123" val="*" />

  <!-- Смещение - смещает всё содержимое на x;y в параметрах -->
  <offset x="12">
    <!-- внутренние элементы - как получает? Через замыкание? -->
    <dot y="5" val="%" />
  </offset>
</template>
```

Если записывать это как-то на расте, то это будет выглядеть так?

```rust
let root_elements = [
  Dot::new(412, 123, '*'),
  Offset::new(12, 0).slot(|| [
    Dot::new(0, 5, '%')
  ])
]
```

Массив с элементами. У `offset` слот-замыкание, которое возвращает новую структуру каждый раз при рендеринге. А что насчёт динамики, насчёт компонентов?

```rust
let root_elements = [
  RootComponent::new()
]
```

Допустим, создаю такой компонент. И допустим, что компоненты должны реализовывать типаж `Component`:

```rust
trait Component {
  fn elements(&self) -> Iterator<Element>
}
```

Что-то вроде такого. Должен вернуться итератор. Массив, множество, поток, вектор - не важно. Что-то, по чему можно пробежаться, и что является таким же элементом, как прочие - точка, смещение или компонент. (или что угодно ещё, что будет поддерживать в будущем рендерер).

Ну допустим, и как же сделать тогда компонент, который будет иметь какое-то смещение, которое он сам будет тиками менять, и какой-то набор точек внутри этого смещения - пусть это будет слово с троеточием на конце. Троеточие будет меняться периодически, анимация.

В виде компонентов:

```
# root
<Root />

# Root
# x и y периодически меняются
<offset :x="x" :y="y">
  <TextWithDots text="Pu-ru-rum, pa-ra-ram" />
</offset>

# TextWithDots
# точки исчезают и появляются
<>
  <dot x="0" val="P" />
  <dot x="1" val="u" />
  <!-- ... -->
  <dot x="20" val="." />
</>
```

А в виде крабика:


```rust
struct Root {
  offset_x: i32;
  offset_y: i32;
  offset: Offset;
  offset_elements: // массив, который создаётся. Итератор по элементам
  text_with_dots: TextWithDots;
}

impl Root {
  new() -> Self {
    // инициализация
  }
}

struct Offset {
  x: i32;
  y: i32;
  slot: ()
}
```

---

Ладно, хрен с ним со слотами. Пока непонятно, как типизировать гибко итераторы, может там вообще неизвестный для меня `dyn`. Сейчас суть в том, чтобы научиться создавать глубоко вложенные структуры, которые бы при этом обновлялись каскадно через самый верхний, и из которых можно было бы собирать композицию.

Для начала надо опустить настоящий рендеринг. Главное ухватить модель. Создаю структуру, в ней ещё три вложенных структуры. Точки, допустим. С символами какими-то. Тикаю главную структуру, она протикивает внутренние. Передаю главную на "рисование", рисует. Повторяю цикл несколько раз

## Делать без этих хитрых компонентов

Сделать один раз хоть как-то. Вручную впилить все разнородные элементы композиции, без сильной автоматизации и абстракций. Три крутилки, центр круга, туман на фоне - пусть будут все прямо тут под рукой. Вручную из обновлять каждый раз, через типаж `Tick`. И вручную отправлять на отрисовку. Отрисовку сделать конечно хоть сколько-то абстрактной - можно передавать им некий виртуальный буффер, который они могут заполнять на своё усмотрение по своему состоянию.
